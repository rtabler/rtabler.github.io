<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Lifeline</title>
  <!-- <meta name="description" content="The HTML5 Herald"> -->
  <!-- <meta name="author" content="SitePoint"> -->

  <!-- <link rel="stylesheet" href="style.css"> -->
  <!-- <link rel="stylesheet" href="css/styles.css?v=1.0"> -->

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
  <h1>Hi</h1>
  <form onsubmit="return submitForm(event)">
    <h2>Message:</h2>
    <input id="inputAge" type="text">
    <input id="inputHappiness" type="text">
    <input id="inputPointDescription" type="text">
    <input id="inputSlopeDescription" type="text">
    <button id="buttonAddPoint" type="button">Add Point</button>
    <table id="tablePoints">
    </table>
    <input id="submitbutton" type="submit">
  </form>
  <script src="jquery-3.3.1.js"></script>
  <script>

var graphModel = [];

$("#buttonAddPoint").click(function() {
  // model
  graphModel.push({
    age: $("#inputAge").val(),
    happiness: $("#inputHappiness").val(),
    pointDescription: $("#inputPointDescription").val(),
    slopeDescription: $("#inputSlopeDescription").val()
  });
  // view
  $("#tablePoints").append(
    $("<tr></tr>")
    .addClass("tablePoint")
    .append( $("<th></th>").append($("#inputAge").val()) )
    .append( $("<th></th>").append($("#inputHappiness").val()) )
    .append( $("<th></th>").append($("#inputPointDescription").val()) )
    .append( $("<th></th>").append($("#inputSlopeDescription").val()) )
  )
});

var submitForm = function( event ) {

  var messageJSON = graphModel;
  var messageText = JSON.stringify( messageJSON );
  // var urlWithMessage = "https://us-central1-lifeline-d8ce8.cloudfunctions.net/addMessage?text="+messageText;
  console.log(messageText);
  $.ajax({
    type: "POST",
    // url: urlWithMessage,
    url: "https://us-central1-lifeline-d8ce8.cloudfunctions.net/addMessage",
    crossDomain: true,
    headers: { 'Access-Control-Allow-Origin': 'https://rtabler.github.io/' },
    dataType: 'text', // https://stackoverflow.com/a/6120260/7213839
    data: graphModel
    // success: function() { alert("returned success"); },
    // error: function() { alert('returned error'); }
  }).done(function( msg ) { 
    alert("returned done");
    console.log( msg );
  }).fail(function( msg ) {
    alert("returned fail")
    console.log( msg );
  });

  event.preventDefault();
  return false;
}
// alert("Hello");
  </script>
</body>
</html>