<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Lifeline</title>
  <!-- <meta name="description" content="The HTML5 Herald"> -->
  <!-- <meta name="author" content="SitePoint"> -->

  <!-- <link rel="stylesheet" href="style.css"> -->
  <!-- <link rel="stylesheet" href="css/styles.css?v=1.0"> -->

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
  <h1>Lifeline</h1>
  <h2>Tell your story:</h2>
  <form onsubmit="return submitForm(event)">
    <h3>Phases:</h3>
    Age:<input id="inputPhaseStartAge"><br>
    Phase name:<input id="inputPhaseDescription"><br>
    <button id="buttonAddPhase" type="button">Add Phase</button>
    <table id="tablePhases"></table>
    <h3>Points:</h3>
    Age:<input id="inputPointAge" type="text"><br>
    Happiness level:<input id="inputPointHappiness" type="text"><br>
    Description (optional):<input id="inputPointDescription" type="text"><br>
    Description of following line (optional):<input id="inputLineDescription" type="text"><br>
    <button id="buttonAddPoint" type="button">Add Point</button>
    <table id="tablePoints"></table>
    <h3>Submit:</h3>
    <input id="submitbutton" type="submit">
  </form>
  <script src="jquery-3.3.1.js"></script>
  <script>

var graphModel = {
  phasesModel: [],
  pointsModel: []
};

$("#buttonAddPhase").click(function() {
  // model
  graphModel.phasesModel.push({
    startAge: $("#inputPhaseStartAge").val(),
    description: $("#inputPhaseDescription").val()
  });
  // view
  $("#tablePhases").append(
    $("<tr></tr>")
    .addClass("tablePhase")
    .append( $("<th></th>").append($("#inputPhaseStartAge").val()) )
    .append( $("<th></th>").append($("#inputPhaseDescription").val()) )
  );
})
$("#buttonAddPoint").click(function() {
  // model
  graphModel.pointsModel.push({
    age: $("#inputPointAge").val(),
    happiness: $("#inputPointHappiness").val(),
    pointDescription: $("#inputPointDescription").val(),
    slopeDescription: $("#inputLineDescription").val()
  });
  // view
  $("#tablePoints").append(
    $("<tr></tr>")
    .addClass("tablePoint")
    .append( $("<th></th>").append($("#inputPointAge").val()) )
    .append( $("<th></th>").append($("#inputPointHappiness").val()) )
    .append( $("<th></th>").append($("#inputPointDescription").val()) )
    .append( $("<th></th>").append($("#inputLineDescription").val()) )
  );
});

var submitForm = function( event ) {

  var messageJSON = graphModel;
  var messageText = JSON.stringify( messageJSON );
  // var urlWithMessage = "https://us-central1-lifeline-d8ce8.cloudfunctions.net/addMessage?text="+messageText;
  console.log(messageText);
  $.ajax({
    type: "POST",
    // url: urlWithMessage,
    url: "https://us-central1-lifeline-d8ce8.cloudfunctions.net/addMessage",
    crossDomain: true,
    headers: { 'Access-Control-Allow-Origin': 'https://rtabler.github.io/' },
    dataType: 'text', // https://stackoverflow.com/a/6120260/7213839
    data: {
      graphModel: graphModel
    }
    // success: function() { alert("returned success"); },
    // error: function() { alert('returned error'); }
  }).done(function( msg ) { 
    alert("returned done");
    console.log( msg );
  }).fail(function( msg ) {
    alert("returned fail")
    console.log( msg );
  });

  event.preventDefault();
  return false;
}
// alert("Hello");
  </script>
</body>
</html>